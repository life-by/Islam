<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আমাদের পূর্ণাঙ্গ ইসলামিক ডায়েরি</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&family=Noto+Naskh+Arabic:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #f4f7f6; --secondary-bg: #ffffff; --primary-text: #333;
            --header-bg: #005a4e; --header-text: #ffffff; --button-bg: #28a745;
            --button-hover-bg: #218838; --nav-button-bg: #17a2b8; --nav-button-hover-bg: #138496;
            --amal-btn-bg: #6f42c1; --amal-btn-hover-bg: #5a349b;
            --logout-bg: #dc3545; --logout-hover-bg: #c82333; --border-color: #dee2e6;
            --shadow: 0 4px 15px rgba(0,0,0,0.1); --success-color: #28a745; --danger-color: #dc3545;
            --light-bg: #f8f9fa; --point-color: #007bff;
        }
        body { font-family: 'Hind Siliguri', sans-serif; background-color: var(--primary-bg); color: var(--primary-text); margin: 0; padding: 10px; line-height: 1.6; }
        .container { max-width: 1000px; margin: auto; background-color: var(--secondary-bg); padding: 20px; border-radius: 12px; box-shadow: var(--shadow); }
        header { background: linear-gradient(135deg, var(--header-bg), #2e8b57); color: var(--header-text); padding: 20px; border-radius: 10px 10px 0 0; text-align: center; margin: -20px -20px 20px -20px; }
        .arabic-text { font-family: 'Noto Naskh Arabic', serif; font-size: 1.3em; line-height: 2; display: block; color: #005a4e; text-align: right; overflow-wrap: break-word; word-wrap: break-word; }
        .zikr-item { background-color: var(--light-bg); border: 1px solid var(--border-color); border-left: 5px solid var(--nav-button-bg); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .summary-card { background-color: var(--light-bg); border-radius: 8px; padding: 15px; text-align: center; border: 1px solid var(--border-color); }
        .summary-card h3 { margin: 0 0 10px 0; color: var(--header-bg); font-size: 1em; }
        .summary-card p { margin: 0; font-size: 1.8em; font-weight: 700; }
        .summary-card p#total-points { color: var(--point-color); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px solid #888; width: 90%; max-width: 700px; border-radius: 10px; position: relative; }
        #password-modal .modal-content { max-width: 400px; text-align: center; }
        .modal-content h3 { margin-top: 0; color: var(--header-bg); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; }
        .close-btn { position: absolute; top: 10px; right: 20px; color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .amal-details-card { background-color: var(--light-bg); border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 20px; padding: 20px; }
        .amal-info p { margin: 5px 0; font-size: 1.05em; }
        .amal-info strong { color: var(--header-bg); }
        .points-tag { background-color: var(--point-color); color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9em; font-weight: bold; }
        #login-screen { text-align: center; padding: 40px 0; } .login-btn { width: 80%; max-width: 250px; padding: 15px; font-size: 1.2em; font-weight: 600; margin: 10px; border-radius: 8px; border: none; cursor: pointer; color: white; } #login-husband { background-color: #007bff; } #login-wife { background-color: #e83e8c; } .modal-content input[type="password"] { width: 100%; padding: 12px; margin-bottom: 15px; box-sizing: border-box; } .modal-buttons { display: flex; gap: 10px; } .modal-buttons button { flex: 1; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; } #password-submit-btn { background-color: var(--button-bg); color: white; } #password-cancel-btn { background-color: #6c757d; color: white; } #main-app { display: none; } .app-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); } #user-greeting { font-size: 1.2em; font-weight: 600; } #logout-btn { background-color: var(--logout-bg); color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; } .navigation { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 25px; } .nav-button { flex-grow: 1; padding: 12px; font-size: 1.1em; font-weight: 600; cursor: pointer; border: none; border-radius: 8px; transition: all 0.3s ease; color: white; min-width: 120px; } #show-form-btn { background-color: var(--nav-button-bg); } #show-data-btn { background-color: var(--button-bg); } #show-amal-btn { background-color: var(--amal-btn-bg); } #data-view { display: none; } .form-group { margin-bottom: 20px; } label { font-weight: 600; margin-bottom: 8px; } input[type="date"], input[type="text"], textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; } fieldset { border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 20px; } legend { font-weight: 600; padding: 0 10px; color: var(--header-bg); } .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; } .checkbox-group label { display: flex; align-items: center; font-weight: normal; } input[type="checkbox"] { margin-right: 8px; width: 18px; height: 18px; } #submit-btn { width: 100%; padding: 15px; background-color: var(--button-bg); color: white; border: none; border-radius: 8px; font-size: 1.2em; cursor: pointer; } .table-container { overflow-x: auto; } table { width: 100%; border-collapse: collapse; margin-top: 20px; } th, td { padding: 12px 15px; border: 1px solid var(--border-color); text-align: center; vertical-align: middle; } thead { background-color: var(--header-bg); color: white; } .delete-btn { background-color: var(--danger-color); color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; } .yes { color: var(--success-color); font-weight: bold; font-size: 1.2em; } .no { color: var(--danger-color); font-weight: bold; font-size: 1.2em; } td.zikr-details ul { margin: 0; padding-left: 0; text-align: left; font-size: 0.9em; } td.zikr-details li { margin-bottom: 15px; list-style: none; } td.zikr-details li .arabic-text { font-size: 1.1em; line-height: 1.8; margin-bottom: 4px; }
        @media screen and (max-width: 768px) {
            .table-container { overflow-x: hidden; } table, thead, tbody, th, td, tr { display: block; } thead tr { position: absolute; top: -9999px; left: -9999px; } tr { border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; background-color: var(--secondary-bg); } td { border: none; border-bottom: 1px solid var(--border-color); position: relative; padding-left: 50%; text-align: right; min-height: 44px; display: flex; align-items: center; justify-content: flex-end; } td:last-child { border-bottom: none; } td:before { position: absolute; top: 50%; left: 15px; transform: translateY(-50%); width: 45%; padding-right: 10px; white-space: nowrap; content: attr(data-label); font-weight: 600; text-align: left; color: var(--header-bg); } td.prayer-marks span { margin: 0 3px; } td.zikr-details { padding: 15px; } td.zikr-details ul { padding-left: 0; text-align: right; } td.actions { justify-content: center; padding: 10px; } td.actions .delete-btn { width: 100%; padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>আমাদের পূর্ণাঙ্গ ইসলামিক ডায়েরি</h1><p>প্রতিদিনের আমলের হিসাব রাখুন</p></header>
        <div id="login-screen"><div class="login-screen-content"><h2>প্রোফাইল নির্বাচন করুন</h2><button class="login-btn" id="login-husband" data-user="husband">স্বামীর প্রোফাইল</button><button class="login-btn" id="login-wife" data-user="wife">স্ত্রীর প্রোফাইল</button></div></div>
        <div id="password-modal" class="modal"><div class="modal-content"><h3 id="modal-title"></h3><div id="setup-password-fields" style="display:none;"><input type="password" id="new-password" placeholder="নতুন পাসওয়ার্ড"><input type="password" id="confirm-password" placeholder="পুনরায় পাসওয়ার্ড"></div><div id="login-password-field"><input type="password" id="password-input" placeholder="পাসওয়ার্ড"></div><p id="password-error" style="color:red; display:none;"></p><div class="modal-buttons"><button id="password-cancel-btn">বাতিল</button><button id="password-submit-btn">প্রবেশ</button></div></div></div>
        
        <div id="amal-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">×</span><h3>গুরুত্বপূর্ণ আমলের ফজিলত</h3>
                <div class="amal-details-card"><p class="arabic-text">اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ، خَلَقْتَنِي وَأَنَا عَبْدُكَ، وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ، أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ، أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ، وَأَبُوءُ لَكَ بِذَنْبِي فَاغْفِرْ لِي، فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ</p><div class="amal-info"><p><strong>ফজিলত:</strong> সকালে পাঠ করলে সন্ধ্যার আগে মারা গেলে জান্নাতি, এবং সন্ধ্যায় পাঠ করলে সকালের আগে মারা গেলে জান্নাতি।</p><p><strong>হাদিস রেফারেন্স:</strong> সহীহ আল-বুখারী, হাদিস: ৬৩০৬</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">১৫ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ</p><div class="amal-info"><p><strong>ফজিলত:</strong> সকালে ও সন্ধ্যায় ৩ বার পাঠ করলে কোনো কিছুই তার ক্ষতি করতে পারবে না।</p><p><strong>হাদিস রেফারেন্স:</strong> জামে' আত-তিরমিজি, হাদিস: ৩৩৮৮</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">প্রতিটির জন্য ৫ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">سُبْحَانَ اللَّهِ الْعَظِيمِ، سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</p><div class="amal-info"><p><strong>ফজিলত:</strong> দুটি কালিমা, যা রহমানের নিকট অতি প্রিয়, যবানে হালকা এবং মীযানের পাল্লায় ভারী।</p><p><strong>হাদিস রেফারেন্স:</strong> সহীহ আল-বুখারী, হাদিস: ৬৬৮২</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">১০ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">أَشْهَدُ أَنْ لَا إِلَٰهَ إِلَّا اللَّهُ، وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ</p><div class="amal-info"><p><strong>ফজিলত:</strong> উত্তমরূপে উযু করার পর পাঠ করলে জান্নাতের আটটি দরজা খুলে দেওয়া হয়।</p><p><strong>হাদিস রেফারেন্স:</strong> সহীহ মুসলিম, হাদিস: ২৩৪</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">৫ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</p><div class="amal-info"><p><strong>ফজিলত:</strong> দিনে ১০০ বার পাঠ করলে সমুদ্রের ফেনার সমান পাপও ক্ষমা করে দেওয়া হবে।</p><p><strong>হাদিস রেফারেন্স:</strong> সহীহ আল-বুখারী, হাদিস: ৬৪০৫</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">১০ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">اللَّهُمَّ اكْفِنِي بِحَلاَلِكَ عَنْ حَرَامِكَ، وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ</p><div class="amal-info"><p><strong>ফজিলত:</strong> পাহাড় সমান ঋণ থাকলেও আল্লাহ তা পরিশোধের ব্যবস্থা করে দেবেন।</p><p><strong>হাদিস রেফারেন্স:</strong> জামে' আত-তিরমিজি, হাদিস: ৩৫৬৩</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">১০ পয়েন্ট</span></p></div></div>
                <div class="amal-details-card"><p class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، وَمِنْ عَذَابِ النَّارِ، وَمِنْ فِتْنَةِ الْمَحْيَا وَالْمَمَاتِ، وَمِنْ شَرِّ فِتْنَةِ الْمَسِيحِ الدَّجَّالِ</p><div class="amal-info"><p><strong>ফজিলত:</strong> রাসূলুল্লাহ (ﷺ) প্রত্যেক নামাযের শেষ বৈঠকে তাশাহহুদ পড়ার পর এই চারটি বিষয় থেকে আশ্রয় প্রার্থনা করতেন।</p><p><strong>হাদিস রেফারেন্স:</strong> সহীহ মুসলিম, হাদিস: ৫৮৮</p><p><strong>অর্জিত পয়েন্ট:</strong> <span class="points-tag">প্রতি নামাজের পর ২ পয়েন্ট</span></p></div></div>
            </div>
        </div>
        
        <div id="main-app">
            <div class="app-header"><span id="user-greeting"></span><button id="logout-btn">লগ আউট</button></div>
            <div class="navigation"><button class="nav-button" id="show-form-btn">ডায়েরি লিখুন</button><button class="nav-button" id="show-data-btn">সংরক্ষিত ডাটা</button><button class="nav-button" id="show-amal-btn">গুরুত্বপূর্ণ আমল</button></div>
            <div id="form-view"><form id="diary-form">
                <div class="form-group"><label for="date">তারিখ:</label><input type="date" id="date" required></div>
                <fieldset><legend>সাধারণ আমল</legend><div class="form-group"><label>পাঁচ ওয়াক্ত নামাজ</label><div class="checkbox-group"><label><input type="checkbox" name="prayer" value="ফজর"> ফজর</label><label><input type="checkbox" name="prayer" value="যোহর"> যোহর</label><label><input type="checkbox" name="prayer" value="আসর"> আসর</label><label><input type="checkbox" name="prayer" value="মাগরিব"> মাগরিব</label><label><input type="checkbox" name="prayer" value="ইশা"> ইশা</label></div></div><div class="form-group"><label for="quran">কুরআন তিলাওয়াত:</label><input type="text" id="quran" placeholder="সূরা ও আয়াত সংখ্যা"></div><div class="form-group"><label for="hadith">হাদিস পাঠ:</label><input type="text" id="hadith" placeholder="বই ও হাদিস সংখ্যা"></div><div class="form-group"><label for="islamicBook">ইসলামিক বই পড়া:</label><input type="text" id="islamicBook" placeholder="বইয়ের নাম ও পৃষ্ঠা সংখ্যা"></div></fieldset>
                <fieldset><legend>বিশেষ জিকির ও আমল</legend><div class="zikr-item"><label for="zikr_sayyidul_istighfar"><span class="arabic-text">اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ، خَلَقْتَنِي وَأَنَا عَبْدُكَ، وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ، أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ، أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ، وَأَبُوءُ لَكَ بِذَنْبِي فَاغْفِرْ لِي، فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ</span><span class="zikr-instruction">সাইয়্যিদুল ইস্তিগফার কতবার পড়েছেন?</span></label><input type="number" id="zikr_sayyidul_istighfar" min="0" placeholder="সংখ্যা"></div><div class="zikr-item"><label for="zikr_subhanallah_azim"><span class="arabic-text">سُبْحَانَ اللَّهِ الْعَظِيمِ، سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</span><span class="zikr-instruction">কতবার পড়েছেন?</span></label><input type="number" id="zikr_subhanallah_azim" min="0" placeholder="সংখ্যা"></div><div class="zikr-item"><label for="zikr_wudu"><span class="arabic-text">أَشْهَدُ أَنْ لَا إِلَٰهَ إِلَّا اللَّهُ، وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ</span><span class="zikr-instruction">অজুর পর কতবার পড়েছেন?</span></label><input type="number" id="zikr_wudu" min="0" placeholder="সংখ্যা"></div><div class="zikr-item"><label><span class="arabic-text">بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ</span><span class="zikr-instruction">এই দোয়াটি ৩ বার করে পড়েছেন কি?</span></label><div class="checkbox-group"><label><input type="checkbox" name="zikr_bismillah" value="সকাল"> সকাল</label><label><input type="checkbox" name="zikr_bismillah" value="সন্ধ্যা"> সন্ধ্যা</label></div></div><div class="zikr-item"><label><span class="arabic-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</span><span class="zikr-instruction">১০০ বার পড়া হয়েছে কি?</span></label><div class="checkbox-group"><label><input type="checkbox" id="zikr_subhanallah_100"> হ্যাঁ, পড়েছি</label></div></div><div class="zikr-item"><label><span class="arabic-text">اللَّهُمَّ اكْفِنِي بِحَلاَلِكَ عَنْ حَرَامِكَ، وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ</span><span class="zikr-instruction">২০ বার পড়া হয়েছে কি?</span></label><div class="checkbox-group"><label><input type="checkbox" id="zikr_allahummakfini"> হ্যাঁ, পড়েছি</label></div></div><div class="zikr-item"><label><span class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، وَمِنْ عَذَابِ النَّارِ، وَمِنْ فِتْنَةِ الْمَحْيَا وَالْمَمَاتِ، وَمِنْ شَرِّ فِتْنَةِ الْمَسِيحِ الدَّجَّالِ</span><span class="zikr-instruction">কোন কোন নামাজের পর পড়েছেন?</span></label><div class="checkbox-group"><label><input type="checkbox" name="zikr_after_prayer" value="ফজর"> ফজর</label><label><input type="checkbox" name="zikr_after_prayer" value="যোহর"> যোহর</label><label><input type="checkbox" name="zikr_after_prayer" value="আসর"> আসর</label><label><input type="checkbox" name="zikr_after_prayer" value="মাগরিব"> মাগরিব</label><label><input type="checkbox" name="zikr_after_prayer" value="ইশা"> ইশা</label></div></div></fieldset>
                    <fieldset><legend>অন্যান্য</legend><textarea id="notes" rows="3" placeholder="দান, ভালো কাজ বা অন্য কোনো মন্তব্য..."></textarea></fieldset>
                    <button type="submit" id="submit-btn">ডায়েরি সংরক্ষণ করুন</button>
                </form>
            </div>
            <div id="data-view">
                <h2 id="data-view-title">আমলের রেকর্ড</h2>
                <div class="dashboard"><div class="summary-card"><h3>আজকের পয়েন্ট</h3><p id="today-points">0</p></div><div class="summary-card"><h3>সর্বমোট পয়েন্ট</h3><p id="total-points">0</p></div><div class="summary-card"><h3>মোট দিন</h3><p id="total-days">0</p></div><div class="summary-card"><h3>গড় নামাজ</h3><p id="avg-prayers">0.0</p></div></div>
                <input type="text" id="search-box" placeholder="তারিখ বা শব্দ দিয়ে সার্চ করুন...">
                <div class="table-container"><table><thead><tr><th>তারিখ</th><th>পয়েন্ট</th><th>নামাজ</th><th>সাধারণ আমল</th><th>বিশেষ জিকির</th><th>অ্যাকশন</th></tr></thead><tbody id="data-table-body"></tbody></table></div>
                <p id="no-data-message" style="text-align:center;display:none;">এখনও কোনো ডাটা সংরক্ষণ করা হয়নি।</p>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const elements = {
        loginScreen: document.getElementById('login-screen'), mainApp: document.getElementById('main-app'),
        passwordModal: document.getElementById('password-modal'), amalModal: document.getElementById('amal-modal'),
        closeAmalBtn: document.querySelector('#amal-modal .close-btn'), userGreeting: document.getElementById('user-greeting'),
        logoutBtn: document.getElementById('logout-btn'), showFormBtn: document.getElementById('show-form-btn'),
        showDataBtn: document.getElementById('show-data-btn'), showAmalBtn: document.getElementById('show-amal-btn'),
        formView: document.getElementById('form-view'), dataView: document.getElementById('data-view'),
        diaryForm: document.getElementById('diary-form'), dateInput: document.getElementById('date'),
        dataTableBody: document.getElementById('data-table-body'), searchBox: document.getElementById('search-box'),
        todayPointsEl: document.getElementById('today-points'), totalPointsEl: document.getElementById('total-points'),
        totalDaysEl: document.getElementById('total-days'), avgPrayersEl: document.getElementById('avg-prayers'),
        noDataMessage: document.getElementById('no-data-message')
    };
    
    let currentUser = null; let loggedInUser = null;
    const PRAYER_NAMES = ['ফজর', 'যোহর', 'আসর', 'মাগরিব', 'ইশা'];

    function calculatePoints(data) {
        let points = 0; if (data.prayers) points += data.prayers.length * 10;
        if (data.quran && data.quran !== 'N/A') points += 15; if (data.hadith && data.hadith !== 'N/A') points += 10;
        if (data.islamicBook && data.islamicBook !== 'N/A') points += 10; if (data.notes) points += 5;
        if (data.specialZikr) { if (data.specialZikr.sayyidulIstighfar > 0) points += 15; if (data.specialZikr.subhanallahAzim > 0) points += 10;
            if (data.specialZikr.wudu > 0) points += 5; if (data.specialZikr.bismillah) points += data.specialZikr.bismillah.length * 5;
            if (data.specialZikr.subhanallah100) points += 10; if (data.specialZikr.allahummakfini) points += 10;
            if (data.specialZikr.afterPrayer) points += data.specialZikr.afterPrayer.length * 2;
        } return points;
    }

    elements.diaryForm.addEventListener('submit', (e) => {
        e.preventDefault(); const date = elements.dateInput.value; if (!date) return alert('তারিখ নির্বাচন করুন।');
        const specialZikr = { sayyidulIstighfar: document.getElementById('zikr_sayyidul_istighfar').value || 0, subhanallahAzim: document.getElementById('zikr_subhanallah_azim').value || 0, wudu: document.getElementById('zikr_wudu').value || 0, bismillah: Array.from(document.querySelectorAll('input[name="zikr_bismillah"]:checked')).map(cb => cb.value), subhanallah100: document.getElementById('zikr_subhanallah_100').checked, allahummakfini: document.getElementById('zikr_allahummakfini').checked, afterPrayer: Array.from(document.querySelectorAll('input[name="zikr_after_prayer"]:checked')).map(cb => cb.value) };
        const entryData = { prayers: Array.from(document.querySelectorAll('input[name="prayer"]:checked')).map(cb => cb.value), quran: document.getElementById('quran').value || 'N/A', hadith: document.getElementById('hadith').value || 'N/A', islamicBook: document.getElementById('islamicBook').value || 'N/A', notes: document.getElementById('notes').value || '', specialZikr: specialZikr };
        entryData.points = calculatePoints(entryData); localStorage.setItem(`diary-${loggedInUser}-${date}`, JSON.stringify(entryData));
        alert(`আমল সংরক্ষিত হয়েছে! আজকের অর্জিত পয়েন্ট: ${entryData.points}`);
        elements.diaryForm.reset(); elements.dateInput.valueAsDate = new Date(); elements.showDataBtn.click();
    });

    function renderTable(entries) {
        elements.dataTableBody.innerHTML = '';
        elements.noDataMessage.style.display = entries.length > 0 ? 'none' : 'block';
        entries.forEach(entry => {
            const row = elements.dataTableBody.insertRow();
            const prayerHTML = PRAYER_NAMES.map(p => { const performed = entry.data.prayers && entry.data.prayers.includes(p); return `<span class="${performed ? 'yes' : 'no'}" title="${p}">${performed ? '✓' : '✗'}</span>`; }).join(' ');
            const generalAmalHTML = `<ul><li><strong>কুরআন:</strong> ${entry.data.quran || 'N/A'}</li><li><strong>হাদিস:</strong> ${entry.data.hadith || 'N/A'}</li><li><strong>বই:</strong> ${entry.data.islamicBook || 'N/A'}</li>${entry.data.notes ? `<li><strong>অন্যান্য:</strong> ${entry.data.notes}</li>` : ''}</ul>`;
            const zikrData = entry.data.specialZikr || {};
            let zikrHTML = '<ul>';
            if (zikrData.sayyidulIstighfar > 0) zikrHTML += `<li><span class="arabic-text">اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ...</span>: <strong>${zikrData.sayyidulIstighfar} বার</strong></li>`;
            if (zikrData.subhanallahAzim > 0) zikrHTML += `<li><span class="arabic-text">سُبْحَانَ اللَّهِ الْعَظِيمِ، سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</span>: <strong>${zikrData.subhanallahAzim} বার</strong></li>`;
            if (zikrData.wudu > 0) zikrHTML += `<li><span class="arabic-text">أَشْهَدُ أَنْ لَا إِلَٰهَ إِلَّا اللَّهُ...</span>: <strong>${zikrData.wudu} বার</strong></li>`;
            if (zikrData.bismillah?.length > 0) zikrHTML += `<li><span class="arabic-text">بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ...</span>: <strong>${zikrData.bismillah.join(', ')}</strong></li>`;
            if (zikrData.subhanallah100) zikrHTML += `<li><span class="arabic-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</span>: <strong>✓ (১০০ বার)</strong></li>`;
            if (zikrData.allahummakfini) zikrHTML += `<li><span class="arabic-text">اللَّهُمَّ اكْفِنِي بِحَلاَلِكَ...</span>: <strong>✓ (২০ বার)</strong></li>`;
            if (zikrData.afterPrayer?.length > 0) zikrHTML += `<li><span class="arabic-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ...</span>: <strong>${zikrData.afterPrayer.join(', ')} এর পর</strong></li>`;
            zikrHTML += '</ul>'; if (zikrHTML === '<ul></ul>') zikrHTML = 'N/A';
            row.innerHTML = `<td data-label="তারিখ">${new Date(entry.date).toLocaleDateString('bn-BD', { day: 'numeric', month: 'short', year: 'numeric' })}</td><td data-label="পয়েন্ট" style="color:var(--point-color); font-weight:bold; font-size: 1.2em;">${entry.data.points || 0}</td><td data-label="নামাজ" class="prayer-marks">${prayerHTML || 'N/A'}</td><td data-label="সাধারণ আমল" class="zikr-details">${generalAmalHTML}</td><td data-label="বিশেষ জিকির" class="zikr-details">${zikrHTML}</td><td data-label="অ্যাকশন" class="actions"><button class="delete-btn" data-key="${entry.date}">মুছুন</button></td>`;
        });
    }

    function setupEventListeners() {
        document.getElementById('login-husband').addEventListener('click', () => handleLoginAttempt('husband'));
        document.getElementById('login-wife').addEventListener('click', () => handleLoginAttempt('wife'));
        document.getElementById('password-cancel-btn').addEventListener('click', () => { document.getElementById('password-modal').style.display = 'none'; });
        document.getElementById('password-submit-btn').addEventListener('click', () => { const storedPassword = localStorage.getItem(`password-${currentUser}`); const passErrorEl = document.getElementById('password-error'); passErrorEl.style.display = 'none'; if (storedPassword) { if (document.getElementById('password-input').value === storedPassword) loginSuccess(); else { passErrorEl.textContent = 'ভুল পাসওয়ার্ড।'; passErrorEl.style.display = 'block'; } } else { const newPass = document.getElementById('new-password').value; const confirmPass = document.getElementById('confirm-password').value; if (newPass.length < 4) { passErrorEl.textContent = 'পাসওয়ার্ড কমপক্ষে ৪ অক্ষরের হতে হবে।'; passErrorEl.style.display = 'block'; } else if (newPass !== confirmPass) { passErrorEl.textContent = 'পাসওয়ার্ড দুটি মেলেনি।'; passErrorEl.style.display = 'block'; } else { localStorage.setItem(`password-${currentUser}`, newPass); loginSuccess(); } } });
        elements.logoutBtn.addEventListener('click', () => { loggedInUser = null; currentUser = null; elements.mainApp.style.display = 'none'; elements.loginScreen.style.display = 'block'; });
        elements.showFormBtn.addEventListener('click', () => { elements.dataView.style.display = 'none'; elements.formView.style.display = 'block'; });
        elements.showDataBtn.addEventListener('click', () => { elements.formView.style.display = 'none'; elements.dataView.style.display = 'block'; renderDataView(); });
        elements.showAmalBtn.addEventListener('click', () => { elements.amalModal.style.display = 'block'; });
        elements.closeAmalBtn.addEventListener('click', () => { elements.amalModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target == elements.amalModal) { elements.amalModal.style.display = 'none'; }});
        elements.dataTableBody.addEventListener('click', (e) => { if (e.target.classList.contains('delete-btn')) { const dateKey = e.target.dataset.key; if (confirm(`${dateKey} তারিখের ডায়েরিটি মুছবেন?`)) { localStorage.removeItem(`diary-${loggedInUser}-${dateKey}`); renderDataView(); } } });
        elements.searchBox.addEventListener('input', (e) => { const term = e.target.value.toLowerCase(); elements.dataTableBody.querySelectorAll('tr').forEach(row => { row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none'; }); });
    }
    function handleLoginAttempt(user) { currentUser = user; const p = localStorage.getItem(`password-${user}`); const passErrorEl = document.getElementById('password-error'); passErrorEl.style.display='none'; if(p) { document.getElementById('modal-title').textContent='পাসওয়ার্ড দিন'; document.getElementById('setup-password-fields').style.display='none'; document.getElementById('login-password-field').style.display='block'; } else { document.getElementById('modal-title').textContent='নতুন পাসওয়ার্ড সেট করুন'; document.getElementById('setup-password-fields').style.display='block'; document.getElementById('login-password-field').style.display='none'; } elements.passwordModal.style.display='block';}
    function loginSuccess() { loggedInUser = currentUser; elements.passwordModal.style.display = 'none'; elements.loginScreen.style.display = 'none'; elements.mainApp.style.display = 'block'; elements.userGreeting.textContent = `${loggedInUser === 'husband' ? 'স্বামীর' : 'স্ত্রীর'} প্রোফাইল`; elements.showFormBtn.click(); elements.dateInput.valueAsDate = new Date(); }
    function getAllEntries() { const entries = []; if (!loggedInUser) return entries; const prefix = `diary-${loggedInUser}-`; for (let i = 0; i < localStorage.length; i++) { const key = localStorage.key(i); if (key.startsWith(prefix)) { try { entries.push({ date: key.replace(prefix, ''), data: JSON.parse(localStorage.getItem(key)) }); } catch(e) { console.error("Could not parse diary entry:", key); } } } return entries.sort((a, b) => new Date(b.date) - new Date(a.date)); }
    function renderDataView() { const entries = getAllEntries(); renderSummary(entries); renderTable(entries); elements.searchBox.value = ''; }
    function renderSummary(entries) {
        const totalEntries = entries.length; elements.totalDaysEl.textContent = totalEntries;
        const totalPoints = entries.reduce((sum, entry) => sum + (entry.data.points || 0), 0); elements.totalPointsEl.textContent = totalPoints;
        const todayEntry = entries.find(e => e.date === new Date().toISOString().split('T')[0]); elements.todayPointsEl.textContent = todayEntry ? (todayEntry.data.points || 0) : 0;
        if (totalEntries === 0) { elements.avgPrayersEl.textContent = '0.0'; return; }
        const totalPrayers = entries.reduce((sum, entry) => sum + (entry.data.prayers ? entry.data.prayers.length : 0), 0);
        elements.avgPrayersEl.textContent = (totalPrayers / totalEntries).toFixed(1);
    }
    setupEventListeners();
});
</script>
</body>
</html>